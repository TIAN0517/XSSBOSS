{
  "permissions": {
    "allow": [
      "Bash(apt update)",
      "Bash(apt install:*)",
      "Bash(dpkg:*)",
      "Bash(systemctl start mysql)",
      "Bash(systemctl enable:*)",
      "Bash(systemctl status:*)",
      "Bash(chmod:*)",
      "Bash(nginx:*)",
      "Bash(systemctl reload:*)",
      "Bash(curl:*)",
      "Bash(journalctl -u php8.3-fpm --no-pager)",
      "Bash(php:*)",
      "Bash(mysql:*)",
      "Bash(ls:*)",
      "Bash(for:*)",
      "Bash(do php:*)",
      "Bash(done:*)",
      "Bash(xxd)",
      "Bash(find:*)",
      "Bash(wget:*)",
      "Bash(systemctl restart:*)",
      "Bash(grep:*)",
      "Bash(git checkout:*)",
      "Bash(do)",
      "Bash(if grep -q \"<style>\" \"$file\")",
      "Bash(then)",
      "Bash(perl:*)",
      "Bash(fi)",
      "Bash(/tmp/test_regex3.php:*)",
      "Bash(/tmp/test_class.php:*)",
      "Bash(/tmp/test_smarty_direct.php:*)",
      "Bash(/tmp/test_compile2.php << 'EOF'\n<?php\nrequire_once '/root/d3cd1-main/www/libs/Smarty.class.php';\nrequire_once '/root/d3cd1-main/www/libs/Smarty_Compiler.class.php';\n\n$smarty = new Smarty\\(\\);\n$smarty->template_dir = '/root/d3cd1-main/www/themes/default/templates';\n$smarty->compile_dir = '/root/d3cd1-main/www/templates_c';\n$smarty->compile_check = true;\n$smarty->force_compile = true;\n\ntry {\n    $tpl = 'login.html';\n    $source = file_get_contents\\($smarty->template_dir . '/' . $tpl\\);\n    echo \"Source length: \" . strlen\\($source\\) . \"\\\\n\";\n    \n    $compiler = new Smarty_Compiler\\(\\);\n    $compiled = '';\n    \n    // Call the compile method with correct args\n    $compiler->_compile_file\\($tpl, $source, $compiled\\);\n    echo \"Compiled length: \" . strlen\\($compiled\\) . \"\\\\n\";\n    \n    // Check for issues\n    if \\(strpos\\($compiled, '{literal}'\\) !== false\\) {\n        echo \"ERROR: {literal} still in compiled output\\\\n\";\n    }\n    if \\(strpos\\($compiled, 'min-height'\\) !== false\\) {\n        echo \"min-height found in output\\\\n\";\n        $pos = strpos\\($compiled, 'min-height'\\);\n        echo \"Context: ...\" . substr\\($compiled, max\\(0, $pos-20\\), 100\\) . \"...\\\\n\";\n    }\n    \n} catch \\(Exception $e\\) {\n    echo \"ERROR: \" . $e->getMessage\\(\\) . \"\\\\n\";\n    echo \"Trace: \" . $e->getTraceAsString\\(\\) . \"\\\\n\";\n}\n?>\nEOF)",
      "Bash(/tmp/test_debug2.php << 'EOF'\n<?php\n// Test what happens inside _compile_file\n\nrequire_once '/root/d3cd1-main/www/libs/Smarty.class.php';\nrequire_once '/root/d3cd1-main/www/libs/Smarty_Compiler.class.php';\n\n$compiler = new Smarty_Compiler\\(\\);\n$source_content = file_get_contents\\('/root/d3cd1-main/www/themes/default/templates/login.html'\\);\n\n$ldq = preg_quote\\($compiler->left_delimiter, '~'\\);\n$rdq = preg_quote\\($compiler->right_delimiter, '~'\\);\n\necho \"Testing pattern replacement:\\\\n\";\n$search = \"~{$ldq}\\\\*\\(.*?\\)\\\\*{$rdq}|{$ldq}\\\\s*literal\\\\s*{$rdq}\\(.*?\\){$ldq}\\\\s*/literal\\\\s*{$rdq}|{$ldq}\\\\s*php\\\\s*{$rdq}\\(.*?\\){$ldq}\\\\s*/php\\\\s*{$rdq}~s\";\n\necho \"Before: \" . strlen\\($source_content\\) . \" chars\\\\n\";\necho \"{literal} count: \" . preg_match_all\\('~{\\\\s*literal\\\\s*}~', $source_content\\) . \"\\\\n\";\n\n// Test replacement\n$temp = $source_content;\n$result = preg_replace_callback\\($search, function\\($m\\) {\n    echo \"Callback called, m[0] len: \" . strlen\\($m[0]\\) . \"\\\\n\";\n    if \\(isset\\($m[1]\\) && $m[1] !== ''\\) {\n        return '';\n    } elseif \\(isset\\($m[2]\\) && $m[2] !== ''\\) {\n        $content = str_replace\\(\"\\\\\\\\\", \"\\\\\\\\\\\\\\\\\", $m[2]\\);\n        $content = str_replace\\(\"'\", \"\\\\\\\\'\", $content\\);\n        return '{php}' . $content . '{/php}';\n    } elseif \\(isset\\($m[3]\\) && $m[3] !== ''\\) {\n        return '{php}' . $m[3] . '{/php}';\n    }\n    return '';\n}, $temp\\);\n\necho \"After: \" . strlen\\($result\\) . \" chars\\\\n\";\necho \"{literal} count after: \" . preg_match_all\\('~{\\\\s*literal\\\\s*}~', $result\\) . \"\\\\n\";\necho \"{php} count after: \" . preg_match_all\\('~{\\\\s*php\\\\s*}~', $result\\) . \"\\\\n\";\n\nif \\(preg_match\\('/{php}.*?min-height/s', $result\\)\\) {\n    echo \"SUCCESS: CSS wrapped in {php}\\\\n\";\n} else {\n    echo \"FAIL: CSS not wrapped in {php}\\\\n\";\n}\n?>\nEOF)",
      "Bash(/tmp/test_trace.php:*)",
      "Bash(/tmp/test_smarty_debug.php:*)",
      "Bash(/tmp/test_simple.php << 'EOF':*)",
      "Bash(/tmp/test_tags.php:*)",
      "WebFetch(domain:raw.githubusercontent.com)",
      "Bash(cat:*)",
      "Bash(tail:*)",
      "Bash(/usr/bin/php7.4:*)"
    ]
  }
}
